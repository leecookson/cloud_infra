version: 2.1

orbs:
  gcp-cli: circleci/gcp-cli@3.3.1

jobs:
  gcp-test:
    docker:
      - image: google/cloud-sdk:latest
    # environment:
    #   GCP_PROJECT_ID: "<your-gcp-project-id>" # set in CircleCI project settings
    #   GCP_SERVICE_ACCOUNT_EMAIL: "<your-sa-email>" # service account email with WIF enabled
    #   GCP_WIP_ID: "<your-wip-pool-id>" # e.g. "projects/123456789/locations/global/workloadIdentityPools/my-pool"
    #   GCP_WIP_PROVIDER_ID: "<your-provider-id>" # e.g. "my-provider"
    steps:
      - checkout
      - gcp-cli/setup

      - run:
          name: Deploy step (replace with your actual logic)
          command: |
            echo "Running deployment commands...."
            gcloud iam workload-identity-pools list --location=global

# Orchestrate our job run sequence
workflows:
  verify-gcp-oidc-access:
    jobs:
      - gcp-test
